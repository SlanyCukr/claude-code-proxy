# Claude Code Proxy Configuration
# Copy to config.toml and set your z.ai API key

[proxy]
port = 8080
debug = true

[anthropic]
base_url = "https://api.anthropic.com"

[zai]
base_url = "https://api.z.ai/api/anthropic"
api_key = ""  # Required - get from z.ai dashboard

[routing]
# Patterns in system prompts that identify subagent requests (routed to z.ai)
subagent_markers = [
    # New zai-speckit-plugin agent patterns
    "# Your Operating Instructions",
    "These instructions define how you work.",
    # Built-in Claude Code agents (Explore, Plan, etc.)
    "You are a Claude agent, built on Anthropic's Claude Agent SDK.",
]
# Markers that force Anthropic routing (exclusions from z.ai)
anthropic_markers = [
    # Built-in Plan/Design agent - keep visible in main session
    "You are a software architect and planning specialist for Claude Code.",
    # Web research agent - needs full Anthropic capabilities
    "Assess First, Then Research",
]

[limits]
max_body_size = 52428800    # 50MB
timeout = 300.0             # 5 minutes
max_connections = 100
max_keepalive = 20
subagent_tool_warning = 30  # Warn subagents after N tool uses (0 to disable)
token_count_timeout = 60.0  # Timeout for /v1/messages/count_tokens endpoint (seconds)
message_timeout = 300.0     # Timeout for /v1/messages endpoint (seconds)

[sanitize]
# Tools to hide from main session (subagents use Task tool instead)
hidden_tools = [
    # Command execution - delegated to subagents
    "Bash",
    "KillShell",
    # Unused tools
    "NotebookEdit",
    "WebFetch",
    "WebSearch",
]

# Markers that identify subagents which DON'T need CLAUDE.md context
# If any marker is found in the system prompt, CLAUDE.md reminder is stripped
# Pattern: "## How You Work: Assess First, Then X" where X identifies the agent type
strip_claude_md_markers = [
    # Built-in Claude agents (Bash, etc.)
    "You are a Claude agent, built on Anthropic's Claude Agent SDK.",
    # Lightweight agents that don't need project context
    "Assess First, Then Search",     # codebase-explorer
    "Assess First, Then Lookup",     # context7-docs
    "Assess First, Then Research",   # web-research
    "Assess First, Then Automate",   # chrome-devtools
]
