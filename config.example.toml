# Claude Code Proxy Configuration
# Copy to config.toml and set your z.ai API key

[proxy]
port = 8080
debug = true

[anthropic]
base_url = "https://api.anthropic.com"

[zai]
base_url = "https://api.z.ai/api/anthropic"
api_key = ""  # Required - get from z.ai dashboard

[routing]
# Patterns that identify subagent requests (triggers sanitization)
subagent_markers = [
    # Plugin agents
    "# Codebase Explorer",
    "# Build Agent",
    "# Python Build Agent",
    "# React/Next.js Build Agent",
    "# Code Reviewer",
    "# Root Cause Agent",
    "# Context7 Docs Lookup",
    "# Web Research Agent",
    "# Chrome DevTools Agent",
    "# Bash Commands Agent",
    "# Security Reviewer",
    "# TDD Guide",
    "# E2E Test Runner",
    "# Refactor & Dead Code Cleaner",
    "# Software Architect",
    "# Plan Refiner",
    # Built-in Claude Code agents (Explore, Plan, etc.)
    "You are a Claude agent, built on Anthropic's Claude Agent SDK.",
]
# Force Anthropic routing (everything EXCEPT codebase-explorer goes to Anthropic)
anthropic_markers = [
    "# Build Agent",
    "# Python Build Agent",
    "# React/Next.js Build Agent",
    "# Code Reviewer",
    "# Root Cause Agent",
    "# Context7 Docs Lookup",
    "# Web Research Agent",
    "# Chrome DevTools Agent",
    "# Bash Commands Agent",
    "# Security Reviewer",
    "# TDD Guide",
    "# E2E Test Runner",
    "# Refactor & Dead Code Cleaner",
    "# Software Architect",
    "# Plan Refiner",
]

[limits]
max_body_size = 52428800    # 50MB
max_connections = 100
max_keepalive = 20
keepalive_expiry = 120.0    # Idle connection lifetime before close (seconds)
connect_timeout = 60.0      # TCP + TLS handshake timeout (seconds)
pool_timeout = 10.0         # Connection pool acquisition timeout (seconds)
keep_alive_timeout = 120    # Uvicorn inbound keep-alive timeout (seconds)
subagent_tool_warning = 30  # Warn subagents after N tool uses (0 to disable)
token_count_timeout = 60.0  # Timeout for /v1/messages/count_tokens endpoint (seconds)
message_timeout = 300.0     # Timeout for /v1/messages endpoint (seconds)

[sanitize]
# Tools to hide from main session (subagents use Task tool instead)
hidden_tools = [
    # Unused tools
    "NotebookEdit",
    "WebFetch",
    "WebSearch",
    "ListMcpResourcesTool",
    "ReadMcpResourceTool",
]

# Built-in agents to hide from Task tool description in main session
# These are stripped so main session uses plugin agents instead
stripped_agents = [
    "general-purpose",
    "statusline-setup",
    "Explore",
    "Plan",
    "claude-code-guide",
    "Bash",
]

# Markers that identify subagents which DON'T need CLAUDE.md context
# If any marker is found in the system prompt, CLAUDE.md reminder is stripped
# Pattern: "## How You Work: Assess First, Then X" where X identifies the agent type
strip_claude_md_markers = [
    # Built-in Claude agents (Bash, etc.)
    "You are a Claude agent, built on Anthropic's Claude Agent SDK.",
    # Lightweight agents that don't need project context
    "Assess First, Then Search",     # codebase-explorer
    "Assess First, Then Lookup",     # context7-docs
    "Assess First, Then Research",   # web-research
    "Assess First, Then Automate",   # chrome-devtools
]
